<% content_for :page_title, render("shared/page_title", 
  subtitle: "View cake details.",
  actions: render("shared/print_qr_button", qr_code_path: qr_code_products_cake_path(@cake))
) %>

<%= render "shared/sidebar_layout/layout",
    tabs: ["details", "cnfs", "library_samples", "qnc_checks", "data_files", "comments", "use_records"],
    tab_path: :products_cake_path,
    path_args: [@cake],
    bottom_action: render("shared/edit_button", label: "Edit Cake", path: edit_products_cake_path(@cake)) do %>

  <% 
    # Map old tab name to new one for backward compatibility
    tab_name = params[:tab] || "details"
    tab_name = "library_samples" if tab_name == "sample_library"
  %>

  <% if tab_name == "qnc_checks" %>
    <div class="d-flex justify-content-end mb-3">
      <%= link_to "Add QNC Check",
                  new_experiments_qnc_check_path(parent_type: "Products::Cake", parent_id: @cake.id),
                  class: "btn btn-primary" %>
    </div>
  <% end %>

  <%= render tab_name, cake: @cake %>

<% end %>

<!-- View File Data Modal (for QNC checks) -->
<% if params[:tab] == "qnc_checks" %>
  <%= render "shared/qnc_check_file_data_modal" %>
<% end %>

