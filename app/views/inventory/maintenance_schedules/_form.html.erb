<% 
  form_type = local_assigns[:form_type] || :create
  is_edit = form_type == :edit
  form_url = is_edit ? 
    inventory_equipment_maintenance_schedule_path(equipment, maintenance_schedule) : 
    inventory_equipment_maintenance_schedules_path(equipment)
  submit_text = is_edit ? "Update Maintenance Schedule" : "Create Maintenance Schedule"
  form_id = is_edit ? "maintenance-schedule-edit-form-#{maintenance_schedule.id}" : "maintenance-schedule-form"
%>

<%= render "shared/form_errors", object: maintenance_schedule %>

<%= form_with(model: [equipment, maintenance_schedule], 
              url: form_url,
              method: is_edit ? :patch : :post,
              local: true,
              html: { 
                class: "maintenance-schedule-form",
                id: form_id
              }) do |f| %>

  <%= default_form_field(f, :name, label_text: "Maintenance Name", required: true) do |req| %>
    <%= f.text_field :name,
        { class: "form-control",
          placeholder: "e.g., Oil Change, Calibration, Safety Inspection" }.merge(req) %>
  <% end %>

  <%= default_form_field(f, :interval_days, label_text: "Interval (days)", required: true) do |req| %>
    <%= f.number_field :interval_days,
        { class: "form-control",
          placeholder: "e.g., 30, 90, 180",
          min: 1,
          step: 1 }.merge(req) %>
    <small class="form-text text-muted">
      How often this maintenance should be performed (in days)
    </small>
  <% end %>

  <%= default_form_field(f, :next_due_date, label_text: "Next Due Date", required: true) do |req| %>
    <%= f.date_field :next_due_date,
        { class: "form-control" }.merge(req) %>
    <small class="form-text text-muted">
      When is this maintenance next due?
    </small>
  <% end %>

  <%= default_form_field(f, :notes, label_text: "Notes (optional)") do |req| %>
    <%= f.text_area :notes,
        { class: "form-control",
          rows: 3,
          placeholder: "Additional notes about this maintenance schedule..." } %>
  <% end %>

  <% if is_edit %>
    <%= default_form_field(f, :is_active, label_text: "Status") do |req| %>
      <div class="d-flex align-items-center gap-3">
        <div class="form-check form-switch">
          <%= f.check_box :is_active, { class: "form-check-input" } %>
          <label class="form-check-label" for="inventory_maintenance_schedule_is_active">
            <%= maintenance_schedule.is_active? ? "Active" : "Inactive" %>
          </label>
        </div>
        <small class="text-muted">
          <% if maintenance_schedule.is_active? %>
            Uncheck to deactivate this maintenance schedule.
          <% else %>
            Check to activate this maintenance schedule.
          <% end %>
        </small>
      </div>
    <% end %>
  <% end %>

  <div class="mt-3 d-flex justify-content-end gap-2">
    <%= f.submit submit_text, class: "btn btn-primary" %>
    <% if is_edit %>
      <button type="button" class="btn btn-outline-secondary" onclick="hideEditForm(<%= maintenance_schedule.id %>)">
        Cancel
      </button>
    <% else %>
      <button type="button" class="btn btn-outline-secondary" onclick="hideMaintenanceForm()">
        Cancel
      </button>
    <% end %>
  </div>

<% end %>
