<% derived_chemicals = local_assigns[:derived_chemicals] || @derived_chemicals || [] %>

<div class="d-flex justify-content-end mb-3">
  <%= link_to new_derived_inventory_chemical_path(chemical),
              class: "btn btn-primary" do %>
    <i class="bi bi-plus-circle me-2"></i>Add Derived Chemical
  <% end %>
</div>

<% if derived_chemicals.any? %>
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle table-compact">
      <thead class="table-light border-bottom">
        <tr>
          <th>Name</th>
          <th>Quantity</th>
          <th>Expiry Date</th>
          <th>Location</th>
          <th>Status</th>
          <th>Print QR</th>
        </tr>
      </thead>
      <tbody>
        <% derived_chemicals.each do |derived_chemical| %>
          <tr>
            <td>
              <%= link_to derived_chemical.name,
                          inventory_chemical_path(derived_chemical),
                          class: "text-decoration-underline fw-semibold" %>
            </td>
            <td><%= "#{derived_chemical.quantity} #{derived_chemical.unit.humanize}" %></td>
            <td><%= derived_chemical.expiry_date.present? ? format_date(derived_chemical.expiry_date) : "N/A" %></td>
            <td><%= derived_chemical.location.present? ? derived_chemical.location.humanize : "N/A" %></td>
            <td>
              <% if derived_chemical.is_active? %>
                <span class="badge bg-success">
                  <i class="bi bi-check-circle me-1"></i>Active
                </span>
              <% else %>
                <span class="badge bg-danger">
                  <i class="bi bi-x-circle me-1"></i>Inactive
                </span>
              <% end %>
            </td>
            <td>
              <%= render "shared/print_qr_button",
                          qr_code_path: qr_code_inventory_chemical_path(derived_chemical),
                          label: "Print QR" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if defined?(@pagy_derived) && @pagy_derived.present? %>
    <div class="mt-3">
      <%== @pagy_derived.series_nav(:bootstrap) %>
    </div>
  <% end %>
<% else %>
  <div class="alert alert-info">
    <i class="bi bi-info-circle me-2"></i>No derived chemicals found. Click "Add Derived Chemical" to create one.
  </div>
<% end %>

