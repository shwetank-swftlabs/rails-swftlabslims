<% 
  data_file = local_assigns[:data_file] || @data_file
  parsed_data = data_file.parsed_data || {}
  sheet_name = parsed_data.keys.first
  sheet_data = parsed_data[sheet_name]
%>

<% if sheet_data.present? && sheet_data['headers'].present? %>
  <div class="mb-3">
    <h6 class="fw-bold mb-2">
      <i class="bi bi-filetype-csv me-2"></i>
      <%= data_file.file_name %>
    </h6>
    <p class="text-muted small mb-3">
      <span class="badge bg-info me-2">CSV</span>
      <%= pluralize(sheet_data['rows']&.length || 0, 'row') %> found
    </p>
  </div>
  
  <div class="table-responsive" style="max-height: 60vh; overflow-y: auto;">
    <table class="table table-sm table-bordered table-striped table-hover">
      <thead class="table-light sticky-top">
        <tr>
          <% sheet_data['headers'].each do |header| %>
            <th class="px-3 py-2"><%= header.humanize %></th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% if sheet_data['rows'].present? %>
          <% sheet_data['rows'].each do |row| %>
            <tr>
              <% sheet_data['headers'].each do |header| %>
                <td class="px-3 py-2">
                  <%= row[header].present? ? row[header] : '<span class="text-muted">â€”</span>'.html_safe %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="<%= sheet_data['headers'].length %>" class="text-center text-muted py-4">
              No data rows found
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="alert alert-info">
    <i class="bi bi-info-circle me-2"></i>
    No data found in this CSV file.
  </div>
<% end %>

