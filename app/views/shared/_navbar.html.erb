<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom" data-turbo="false">
  <div class="container">

    <% if sidebar_layout? %>
      <button class="navbar-toggler d-lg-none"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#sidebarNavbar"
              aria-controls="sidebarNavbar"
              aria-expanded="false"
              aria-label="Toggle sidebar">
        <span><i class="bi bi-layout-sidebar-inset fs-3"></i></span>
      </button>
    <% end %>

    <!-- App Name / Logo -->
    <%= link_to root_path, class: "navbar-brand fw-bold" do %>
      SWFTLabsLIMS
    <% end %>

    <!-- Mobile Navbar Toggler -->
    <button class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#mainNavbar"
            aria-controls="mainNavbar"
            aria-expanded="false"
            aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible Navbar Content -->
    <div class="collapse navbar-collapse" id="mainNavbar">

      <ul class="navbar-nav me-auto"></ul>

      <ul class="navbar-nav ms-auto">

        <!-- Admin -->
        <% if current_user.is_admin? %>
          <li class="nav-item">
            <%= link_to "Admin",
              admin_path,
              class: "nav-link #{'active text-dark fw-semibold border-bottom border-dark-subtle' if request.path.start_with?('/admin')}",
              style: (request.path.start_with?('/admin') ? 'border-bottom-width: 3px !important;' : nil)
            %>
          </li>
        <% end %>

        <!-- Experiments Dropdown -->
        <li class="nav-item dropdown" data-controller="dropdown">
          <a class="nav-link dropdown-toggle <%= 'active text-dark fw-semibold border-bottom border-dark-subtle' if request.path.start_with?('/experiments') %>"
             href="#"
             id="experimentsDropdown"
             data-action="click->dropdown#toggle"
             aria-expanded="false"
             style="<%= request.path.start_with?('/experiments') ? 'border-bottom-width: 3px !important;' : '' %>">
            Experiments
          </a>

          <ul class="dropdown-menu" aria-labelledby="experimentsDropdown" data-dropdown-target="menu">
            <li><%= link_to "NOP Processes", experiments_nop_processes_path, class: "dropdown-item #{'active' if request.path.start_with?('/experiments/nop_processes')}" %></li>
            <li><hr class="dropdown-divider"></li>
            <li><%= link_to "All Experiments", experiments_path, class: "dropdown-item #{'active' if request.path == '/experiments'}" %></li>
          </ul>
        </li>

        <!-- Inventory Dropdown -->
        <li class="nav-item dropdown" data-controller="dropdown">
          <a class="nav-link dropdown-toggle <%= 'active text-dark fw-semibold border-bottom border-dark-subtle' if request.path.start_with?('/inventory') %>"
             href="#"
             id="inventoryDropdown"
             data-action="click->dropdown#toggle"
             aria-expanded="false"
             style="<%= request.path.start_with?('/inventory') ? 'border-bottom-width: 3px !important;' : '' %>">
            Inventory
          </a>

          <ul class="dropdown-menu" aria-labelledby="inventoryDropdown" data-dropdown-target="menu">
            <li><%= link_to "Equipments", inventory_equipments_path, class: "dropdown-item #{'active' if request.path.start_with?('/inventory/equipments')}" %></li>
            <li><%= link_to "Chemicals", inventory_chemicals_path, class: "dropdown-item #{'active' if request.path.start_with?('/inventory/chemicals')}" %></li>
            <li><%= link_to "Feedstock", inventory_feedstocks_path, class: "dropdown-item #{'active' if request.path.start_with?('/inventory/feedstocks')}" %></li>
            <li><hr class="dropdown-divider"></li>
            <li><%= link_to "All Inventory", inventory_path, class: "dropdown-item #{'active' if request.path == '/inventory'}" %></li>
          </ul>
        </li>

        <!-- Products Dropdown -->
        <li class="nav-item dropdown" data-controller="dropdown">
          <a class="nav-link dropdown-toggle <%= 'active text-dark fw-semibold border-bottom border-dark-subtle' if request.path.start_with?('/products') %>"
             href="#"
             id="productsDropdown"
             data-action="click->dropdown#toggle"
             aria-expanded="false"
             style="<%= request.path.start_with?('/products') ? 'border-bottom-width: 3px !important;' : '' %>">
            Products
          </a>

          <ul class="dropdown-menu" aria-labelledby="productsDropdown" data-dropdown-target="menu">
            <li><%= link_to "Cakes", products_cakes_path, class: "dropdown-item #{'active' if request.path.start_with?('/products/cakes')}" %></li>
            <li><hr class="dropdown-divider"></li>
            <li><%= link_to "All Products", products_path, class: "dropdown-item #{'active' if request.path == '/products'}" %></li>
          </ul>
        </li>

        <!-- User Dropdown -->
        <li class="nav-item dropdown ms-2" data-controller="dropdown">
          <a class="nav-link dropdown-toggle text-muted small"
             href="#"
             id="userDropdown"
             data-action="click->dropdown#toggle"
             aria-expanded="false">
            <span class="text-muted">Logged in as</span>
            <span class="fw-semibold text-dark"><%= current_user.first_name.capitalize %></span>
          </a>

          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown" data-dropdown-target="menu">
            <li>
              <%= button_to "Logout",
                logout_path,
                method: :delete,
                class: "dropdown-item text-danger fw-semibold border-0 bg-transparent w-100 text-start",
                style: "color: #dc3545 !important;",
                onclick: "return confirm('Are you sure you want to log out?');"
              %>
            </li>
          </ul>
        </li>

      </ul>
    </div>
  </div>
</nav>
