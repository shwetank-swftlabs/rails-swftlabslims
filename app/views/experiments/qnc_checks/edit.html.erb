<% content_for :page_title, render("shared/page_title", subtitle: "Edit QNC check request details.") %>

<%= render "shared/form_errors", object: @qnc_check %>

<%= form_with(model: @qnc_check, local: true, url: experiments_qnc_check_path(@qnc_check), method: :patch, html: { class: "qnc-check-form" }) do |f| %>

  <%= default_form_field(f, :name, label_text: "Name", required: true) do |req| %>
    <%= f.text_field :name,
                    { class: "form-control",
                      placeholder: "Enter QNC check request name",
                      value: @qnc_check.name }.merge(req) %>
  <% end %>

  <%= default_form_field(f, :location, label_text: "Location", required: false) do |req| %>
    <%= f.text_field :location,
                    { class: "form-control",
                      placeholder: "Enter location (optional)",
                      value: @qnc_check.location } %>
  <% end %>

  <%= default_form_field(f, :requested_from, label_text: "Assigned To", required: true) do |req| %>
    <%= render "shared/forms/searchable_dropdown",
        form: f,
        field: :requested_from,
        options: @users.map { |user| { key: user.email, val: user.email } },
        placeholder: "Search or type @swftlabs.com email",
        help_text: "Must be a valid @swftlabs.com email address. You can search and select from the list or type a new email.",
        value: @qnc_check.requested_from,
        required: true,
        input_attrs: req %>
  <% end %>

  <%= default_form_field(f, :expected_completion_date, label_text: "Expected Completion Date", required: true) do |req| %>
    <%= f.date_field :expected_completion_date,
                    { class: "form-control",
                      value: @qnc_check.expected_completion_date }.merge(req) %>
  <% end %>

  <%= default_form_field(f, :is_active, label_text: "Status") do |req| %>
    <div class="d-flex align-items-center gap-3">
      <div class="form-check form-switch">
        <%= f.check_box :is_active, { class: "form-check-input" } %>
        <label class="form-check-label" for="experiments_qnc_check_is_active">
          <%= @qnc_check.is_active? ? "Pending" : "Completed" %>
        </label>
      </div>
      <small class="text-muted">
        (<%= @qnc_check.is_active? ? "Uncheck to mark as completed" : "Check to mark as pending" %>)
      </small>
    </div>
  <% end %>

  <div class="mt-4">
    <div class="d-flex gap-2">
      <%= link_to "Cancel", experiments_qnc_check_path(@qnc_check), class: "btn btn-outline-secondary px-4" %>
      <%= f.submit "Update QNC Check Request", 
            class: "btn btn-primary px-4",
            data: { turbo_confirm: "Are you sure you want to update this QNC check request?" } %>
    </div>
  </div>

<% end %>

